'use strict';var frame,woostifyData=woostify_variation_swatches_admin||{};document.addEventListener("DOMContentLoaded",function(){function a(){d.find(".woostify-variation-swatches-term-name input, .woostify-variation-swatches-term-slug input").val(""),f.removeClass("is-active"),g.removeClass("error success").hide(),d.hide()}var b=window.wp,c=jQuery("body");jQuery("#term-color").wpColorPicker(),c.on("click",".woostify-variation-swatches-upload-image-button",function(a){a.preventDefault();var c=jQuery(this);return frame?void frame.open():void(frame=b.media.frames.downloadable_file=b.media({title:woostifyData.i18n.mediaTitle,button:{text:woostifyData.i18n.mediaButton},multiple:!1}),frame.on("select",function(){var a=frame.state().get("selection").first().toJSON();c.siblings("input.woostify-variation-swatches-term-image").val(a.id),c.siblings(".woostify-variation-swatches-remove-image-button").show(),c.parent().prev(".woostify-variation-swatches-term-image-thumbnail").find("img").attr("src",a.sizes.thumbnail.url)}),frame.open())}).on("click",".woostify-variation-swatches-remove-image-button",function(){var a=jQuery(this);return a.siblings("input.woostify-variation-swatches-term-image").val(""),a.siblings(".woostify-variation-swatches-remove-image-button").show(),a.parent().prev(".woostify-variation-swatches-term-image-thumbnail").find("img").attr("src",woostifyData.placeholder),!1});var d=jQuery("#woostify-variation-swatches-modal-container"),f=d.find(".spinner"),g=d.find(".message"),h=null;c.on("click",".variation_swatches_add_new_attribute",function(a){a.preventDefault();var c=jQuery(this),e=b.template("woostify-variation-swatches-input-tax"),f={type:c.data("type"),tax:c.closest(".woocommerce_attribute").data("taxonomy")};d.find(".woostify-variation-swatches-term-swatch").html(jQuery("#tmpl-woostify-variation-swatches-input-"+f.type).html()),d.find(".woostify-variation-swatches-term-tax").html(e(f)),"color"==f.type&&d.find("input.woostify-variation-swatches-input-color").wpColorPicker(),h=c.closest(".woocommerce_attribute.wc-metabox"),d.show()}).on("click",".woostify-variation-swatches-modal-close, .woostify-variation-swatches-modal-backdrop",function(b){b.preventDefault(),a()}),c.on("click",".woostify-variation-swatches-new-attribute-submit",function(c){c.preventDefault();var e=jQuery(this),i=e.data("type"),j=!1,k={};d.find(".woostify-variation-swatches-input").each(function(){var a=jQuery(this);"slug"==a.attr("name")||a.val()?a.removeClass("error"):(a.addClass("error"),j=!0),k[a.attr("name")]=a.val()});j||(f.addClass("is-active"),g.hide(),b.ajax.send("variation_swatches_add_new_attribute",{data:k,error:function(a){f.removeClass("is-active"),g.addClass("error").text(a).show()},success:function(b){f.removeClass("is-active"),g.addClass("success").text(b.msg).show(),h.find("select.attribute_values").append("<option value=\""+b.id+"\" selected=\"selected\">"+b.name+"</option>"),h.find("select.attribute_values").change(),a()}}))})});